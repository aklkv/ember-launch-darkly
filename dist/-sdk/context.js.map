{"version":3,"file":"context.js","sources":["../../src/-sdk/context.ts"],"sourcesContent":["import { tracked } from '@glimmer/tracking';\nimport { TrackedMap } from 'tracked-built-ins';\nimport type {\n  LDClient,\n  LDEvaluationDetail,\n  LDFlagSet,\n  LDFlagValue,\n} from 'launchdarkly-js-client-sdk';\n\nconst STORAGE_KEY = 'ember-launch-darkly';\n\n/**\n * Describes how initialization completed (or recovered).\n *\n * - `'initialized'` — LD SDK initialized successfully, flags are live.\n * - `'failed'`      — LD SDK failed to initialize (timeout, network error, etc.).\n *                      Flags come from bootstrap/allFlags and may be empty.\n * - `'local'`       — Running in local mode with `localFlags`.\n */\nexport type InitStatus = 'initialized' | 'failed' | 'local';\n\n/**\n * Callback invoked whenever the {@link InitStatus} of the context changes.\n *\n * This is most useful for reacting to post-init recovery: when the LD SDK\n * reconnects after a failed initialization, the status transitions from\n * `'failed'` to `'initialized'`.\n */\nexport type OnStatusChange = (\n  newStatus: InitStatus,\n  previousStatus: InitStatus,\n) => void;\n\n/**\n * Callback invoked whenever the LD SDK emits a runtime error.\n *\n * If you do not provide this callback, errors are logged via `@ember/debug`'s\n * `warn()`. If you do, errors are forwarded to your callback instead.\n */\nexport type OnError = (error: Error) => void;\n\n/**\n * Options for constructing a {@link Context}.\n *\n * All properties are optional — a bare `new Context()` produces a valid\n * local-mode context with no flags.\n */\nexport interface ContextOptions<ELDFlagSet extends LDFlagSet = LDFlagSet> {\n  /** Initial flag values. */\n  flags?: ELDFlagSet;\n\n  /** The underlying LD client (omit for local mode). */\n  client?: LDClient;\n\n  /** How initialization completed. Inferred from `client` if omitted. */\n  initStatus?: InitStatus;\n\n  /** The error from `waitForInitialization()`, if any. */\n  initError?: unknown;\n\n  /** Fires when the init status transitions (e.g. failed → initialized). */\n  onStatusChange?: OnStatusChange;\n\n  /** Fires when the SDK emits a runtime error. */\n  onError?: OnError;\n}\n\ndeclare global {\n  interface Window {\n    // eslint-disable-next-line @typescript-eslint/no-explicit-any\n    __LD__?: Context<any>;\n  }\n}\n\nfunction setPersistedFlags<ELDFlagSet extends LDFlagSet>(\n  context: Context<ELDFlagSet>,\n) {\n  const persistedFlags = window.localStorage.getItem(STORAGE_KEY);\n\n  if (persistedFlags) {\n    context.replaceFlags(JSON.parse(persistedFlags) as ELDFlagSet);\n  }\n}\n\nfunction setCurrentContext<ELDFlagSet extends LDFlagSet>(\n  context: Context<ELDFlagSet>,\n) {\n  setPersistedFlags(context);\n  window.__LD__ = context;\n}\n\nfunction getCurrentContext<\n  Flags extends LDFlagSet = LDFlagSet,\n>(): Context<Flags> | null {\n  return (window.__LD__ as Context<Flags>) ?? null;\n}\n\nfunction removeCurrentContext() {\n  delete window.__LD__;\n}\n\nclass Context<ELDFlagSet extends LDFlagSet> {\n  _flags = new TrackedMap<keyof ELDFlagSet, ELDFlagSet[keyof ELDFlagSet]>();\n  _client?: LDClient | null = null;\n  @tracked _initStatus: InitStatus;\n  @tracked _initError?: unknown;\n  @tracked _lastError?: Error;\n  _onStatusChange?: OnStatusChange;\n  _onError?: OnError;\n\n  constructor(options: ContextOptions<ELDFlagSet> = {}) {\n    const { flags, client, initStatus, initError, onStatusChange, onError } =\n      options;\n\n    this._client = client;\n    this._initStatus = initStatus ?? (client ? 'initialized' : 'local');\n    this._initError = initError;\n    this._onStatusChange = onStatusChange;\n    this._onError = onError;\n\n    this.updateFlags(flags ?? ({} as ELDFlagSet));\n  }\n\n  updateFlags(flags: ELDFlagSet) {\n    for (const [key, value] of Object.entries(flags) as [\n      keyof ELDFlagSet,\n      ELDFlagSet[keyof ELDFlagSet],\n    ][]) {\n      this._flags.set(key, value);\n    }\n  }\n\n  replaceFlags(flags: ELDFlagSet) {\n    this._flags.clear();\n    this.updateFlags(flags);\n  }\n\n  enable(key: keyof ELDFlagSet) {\n    this._flags.set(key, true as ELDFlagSet[keyof ELDFlagSet]);\n  }\n\n  disable(key: keyof ELDFlagSet) {\n    this._flags.set(key, false as ELDFlagSet[keyof ELDFlagSet]);\n  }\n\n  set(key: keyof ELDFlagSet, value: LDFlagValue) {\n    this._flags.set(key, value as ELDFlagSet[keyof ELDFlagSet]);\n  }\n\n  get<T>(key: keyof ELDFlagSet, defaultValue?: T | null): T {\n    if (!this._flags.has(key) && defaultValue != null) {\n      return defaultValue;\n    }\n\n    return this._flags.get(key) as T;\n  }\n\n  persist() {\n    window.localStorage.setItem(STORAGE_KEY, JSON.stringify(this.allFlags));\n  }\n\n  resetPersistence() {\n    window.localStorage.removeItem(STORAGE_KEY);\n  }\n\n  get allFlags() {\n    const allFlags: LDFlagSet = {};\n\n    for (const [key, value] of this._flags.entries()) {\n      allFlags[key as string] = value;\n    }\n\n    return allFlags;\n  }\n\n  get isLocal() {\n    return this.client == null;\n  }\n\n  /**\n   * How initialization completed.\n   *\n   * - `'initialized'` — LD SDK initialized successfully.\n   * - `'failed'`      — LD SDK failed to initialize (flags may be empty or from bootstrap).\n   * - `'local'`       — Running in local mode.\n   *\n   * This property is reactive (`@tracked`). When the SDK recovers after a\n   * failed init, it automatically transitions to `'initialized'`.\n   */\n  get initStatus(): InitStatus {\n    return this._initStatus;\n  }\n\n  /**\n   * Whether initialization completed successfully (status is `'initialized'` or `'local'`).\n   */\n  get initSucceeded(): boolean {\n    return this._initStatus === 'initialized' || this._initStatus === 'local';\n  }\n\n  /**\n   * The error from `waitForInitialization()` if initialization failed, otherwise `undefined`.\n   */\n  get initError(): unknown {\n    return this._initError;\n  }\n\n  /**\n   * Transition the init status. Fires `onStatusChange` if the status actually changed.\n   * @internal\n   */\n  transitionStatus(newStatus: InitStatus, error?: unknown) {\n    const previous = this._initStatus;\n\n    if (previous === newStatus) {\n      return;\n    }\n\n    this._initStatus = newStatus;\n    this._initError = error;\n    this._onStatusChange?.(newStatus, previous);\n  }\n\n  /**\n   * The most recent runtime error emitted by the LD SDK, or `undefined`.\n   *\n   * Reactive (`@tracked`) — templates and computed properties that read this\n   * will automatically re-render when a new error arrives.\n   */\n  get lastError(): Error | undefined {\n    return this._lastError;\n  }\n\n  /**\n   * Record a runtime error from the SDK's `'error'` event.\n   * @internal\n   */\n  handleError(error: Error) {\n    this._lastError = error;\n    this._onError?.(error);\n  }\n\n  // ---------------------------------------------------------------------------\n  // Thin SDK passthroughs\n  //\n  // These delegate directly to the underlying LDClient. The addon's value-add\n  // is the reactive flag layer above — these methods are here so consumers\n  // don't need to reach into `context.client` for common operations.\n  // ---------------------------------------------------------------------------\n\n  /**\n   * Like `variation()`, but includes the evaluation reason.\n   *\n   * Requires `evaluationReasons: true` in the initialization options.\n   *\n   * @see https://docs.launchdarkly.com/sdk/features/evaluation-reasons\n   */\n  variationDetail(key: string, defaultValue?: LDFlagValue): LDEvaluationDetail {\n    if (!this._client) {\n      /* eslint-disable @typescript-eslint/no-unsafe-assignment */\n      return {\n        value: this.get<LDFlagValue>(key, defaultValue),\n        variationIndex: undefined,\n        reason: undefined,\n      };\n      /* eslint-enable @typescript-eslint/no-unsafe-assignment */\n    }\n\n    return this._client.variationDetail(key, defaultValue);\n  }\n\n  /**\n   * Send a custom event to LaunchDarkly for Experimentation metrics.\n   *\n   * No-op in local mode.\n   *\n   * @see https://docs.launchdarkly.com/sdk/features/events\n   */\n  track(key: string, data?: unknown, metricValue?: number) {\n    this._client?.track(key, data, metricValue);\n  }\n\n  /**\n   * Flush pending analytics events to LaunchDarkly without closing the client.\n   *\n   * Useful before a page navigation in an SPA to ensure events are delivered.\n   *\n   * No-op in local mode.\n   *\n   * @see https://docs.launchdarkly.com/sdk/features/flush\n   */\n  async flush(): Promise<void> {\n    await this._client?.flush();\n  }\n\n  /**\n   * Shut down the LD client, release resources, and flush pending events.\n   *\n   * When `force` is `true`, the client is closed without waiting for the\n   * pending event flush to complete. This is useful when the LD endpoint\n   * is unresponsive and `await close()` would hang.\n   *\n   * After calling this, the context should not be used. Typically called\n   * during application teardown or in test cleanup.\n   */\n  async close({ force = false }: { force?: boolean } = {}): Promise<void> {\n    if (!this._client) {\n      return;\n    }\n\n    if (force) {\n      // Fire-and-forget — don't await the flush that close() triggers.\n      void this._client.close();\n    } else {\n      await this._client.close();\n    }\n  }\n\n  /**\n   * Shut down the LD client and remove this context from the global state,\n   * allowing `initialize()` to be called again.\n   *\n   * This is the recommended way to handle a failed initialization when you\n   * want to fall back to local mode:\n   *\n   * ```ts\n   * const result = await initialize(clientSideId, user, options);\n   * if (!result.isOk) {\n   *   await result.context.destroy();\n   *   await initialize(clientSideId, user, { mode: 'local', localFlags: DEFAULTS });\n   * }\n   * ```\n   *\n   * Pass `{ force: true }` when the endpoint is unresponsive to avoid\n   * hanging on the pending flush.\n   */\n  async destroy({ force = false }: { force?: boolean } = {}): Promise<void> {\n    await this.close({ force });\n    removeCurrentContext();\n  }\n\n  get persisted(): ELDFlagSet | undefined {\n    const persisted = window.localStorage.getItem(STORAGE_KEY);\n    return persisted ? (JSON.parse(persisted) as ELDFlagSet) : undefined;\n  }\n\n  get client(): LDClient | null | undefined {\n    return this._client;\n  }\n\n  get user() {\n    if (this.isLocal) {\n      return { key: 'local-mode-no-user-specified' };\n    }\n\n    if (this.client) {\n      return this.client.getContext();\n    }\n\n    return { key: 'unknown-user' };\n  }\n}\n\nexport {\n  getCurrentContext,\n  removeCurrentContext,\n  setCurrentContext,\n  setPersistedFlags,\n  Context as default,\n};\n"],"names":["STORAGE_KEY","setPersistedFlags","context","persistedFlags","window","localStorage","getItem","replaceFlags","JSON","parse","setCurrentContext","__LD__","getCurrentContext","removeCurrentContext","Context","_flags","TrackedMap","_client","g","prototype","tracked","i","_onStatusChange","_onError","constructor","options","flags","client","initStatus","initError","onStatusChange","onError","_initStatus","_initError","updateFlags","key","value","Object","entries","set","clear","enable","disable","get","defaultValue","has","persist","setItem","stringify","allFlags","resetPersistence","removeItem","isLocal","initSucceeded","transitionStatus","newStatus","error","previous","lastError","_lastError","handleError","variationDetail","variationIndex","undefined","reason","track","data","metricValue","flush","close","force","destroy","persisted","user","getContext"],"mappings":"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"}